# Complexity-Aware Routing Configuration - ACS-Mentor V2.1
# ä»»åŠ¡å¤æ‚åº¦æ„ŸçŸ¥çš„æ™ºèƒ½è·¯ç”±ç³»ç»Ÿ

# ============================================================================
# è®¾è®¡å“²å­¦
# ============================================================================

philosophy: |
  ä»Claude-Flowçš„Swarm vs Hive-MindåŒæ¨¡å¼å¯å‘ï¼š
  - ç®€å•é—®é¢˜ï¼šå¿«é€Ÿå“åº”ï¼ˆquick_guidanceï¼‰
  - å¤æ‚é—®é¢˜ï¼šæ·±åº¦å¼•å¯¼ï¼ˆdeep_mentorshipï¼‰
  - è‡ªåŠ¨æ ¹æ®(å¤æ‚åº¦ Ã— ç”¨æˆ·æ°´å¹³)çŸ©é˜µåŒ¹é…æœ€ä½³æ¨¡å¼

version: "2.1.0"
design_date: "2025-11-16"

# ============================================================================
# Task Complexity Scoring - ä»»åŠ¡å¤æ‚åº¦è¯„åˆ†
# ============================================================================

task_complexity_scoring:

  description: |
    å¤šç»´åº¦è¯„ä¼°ç”¨æˆ·é—®é¢˜çš„å¤æ‚åº¦
    è¾“å‡º: 0.0-1.0çš„å¤æ‚åº¦åˆ†æ•°

  dimensions:

    # ç»´åº¦1: æ¦‚å¿µæ·±åº¦ (Conceptual Depth)
    conceptual_depth:
      weight: 0.40

      signal_mapping:
        low_complexity:  # 0.0-0.3
          keywords:
            - "på€¼"
            - "æ˜¾è‘—æ€§"
            - "æè¿°ç»Ÿè®¡"
            - "mean"
            - "median"
            - "tæ£€éªŒ"
            - "å¡æ–¹æ£€éªŒ"
          characteristics:
            - "å•ä¸€æ¦‚å¿µ"
            - "æ•™ç§‘ä¹¦çº§åˆ«"
            - "æœ‰æ ‡å‡†ç­”æ¡ˆ"

        medium_complexity:  # 0.4-0.7
          keywords:
            - "å€¾å‘æ€§è¯„åˆ†"
            - "propensity score"
            - "å·¥å…·å˜é‡"
            - "æ•æ„Ÿæ€§åˆ†æ"
            - "multiple imputation"
            - "validation"
            - "Coxå›å½’"
          characteristics:
            - "éœ€è¦æ–¹æ³•è®ºçŸ¥è¯†"
            - "æ¶‰åŠå‡è®¾æ£€éªŒ"
            - "å¤šä¸ªæ¦‚å¿µç»„åˆ"

        high_complexity:  # 0.8-1.0
          keywords:
            - "å› æœå›¾"
            - "DAG"
            - "åäº‹å®æ¨ç†"
            - "counterfactual"
            - "è¯†åˆ«ç­–ç•¥"
            - "marginal structural model"
            - "g-computation"
            - "difference-in-differences"
          characteristics:
            - "éœ€è¦ç†è®ºæ¡†æ¶"
            - "å¤šå±‚æ¬¡æŠ½è±¡æ€ç»´"
            - "æ— å”¯ä¸€æ­£ç¡®ç­”æ¡ˆ"

      scoring_logic: |
        def score_conceptual_depth(user_message):
            score = 0.0

            # æ£€æµ‹å…³é”®è¯
            low_matches = count_keyword_matches(user_message, low_complexity.keywords)
            medium_matches = count_keyword_matches(user_message, medium_complexity.keywords)
            high_matches = count_keyword_matches(user_message, high_complexity.keywords)

            # åˆ†æ•°è®¡ç®—
            if high_matches > 0:
                score = 0.8 + min(high_matches * 0.05, 0.2)
            elif medium_matches > 0:
                score = 0.4 + min(medium_matches * 0.1, 0.3)
            elif low_matches > 0:
                score = 0.1 + min(low_matches * 0.05, 0.2)
            else:
                # æ— æ³•åˆ†ç±»ï¼Œé»˜è®¤ä¸­ç­‰
                score = 0.5

            return min(score, 1.0)

    # ç»´åº¦2: ç”¨æˆ·ä¸ç¡®å®šæ€§ (User Uncertainty)
    user_uncertainty:
      weight: 0.35

      signal_mapping:
        low_uncertainty:  # 0.0-0.3
          patterns:
            - "ç”¨æˆ·é—®é¢˜æ˜ç¡®"
            - "æä¾›äº†å…·ä½“å‚æ•°"
            - "å·²ç»æœ‰åˆæ­¥æ–¹æ¡ˆ"
          examples:
            - "RCTæ ·æœ¬é‡è®¡ç®—ï¼Œpower=0.8ï¼Œeffect size=0.3ï¼Œåº”è¯¥ç”¨ä»€ä¹ˆå…¬å¼ï¼Ÿ"
            - "æˆ‘çš„logistic regressionç»“æœAUC=0.75ï¼Œè¿™ä¸ªå€¼å¯ä»¥æ¥å—å—ï¼Ÿ"

        medium_uncertainty:  # 0.4-0.7
          patterns:
            - "ç”¨æˆ·æœ‰ç–‘é—®ä½†æ–¹å‘æ¸…æ¥š"
            - "åœ¨å¤šä¸ªé€‰é¡¹é—´çŠ¹è±«"
            - "éœ€è¦confirmè‡ªå·±çš„ç†è§£"
          signals:
            - "ä¸ç¡®å®š"
            - "åº”è¯¥ç”¨å“ªä¸ª"
            - "æ˜¯å¦å¯ä»¥"
            - "å“ªä¸ªæ›´å¥½"
          examples:
            - "æˆ‘çš„ç ”ç©¶æ˜¯RCTï¼Œä¸ç¡®å®šåº”è¯¥ç”¨intention-to-treatè¿˜æ˜¯per-protocolåˆ†æï¼Ÿ"

        high_uncertainty:  # 0.8-1.0
          patterns:
            - "ç”¨æˆ·å®Œå…¨å›°æƒ‘"
            - "ä¸çŸ¥é“ä»ä½•å…¥æ‰‹"
            - "éœ€è¦å…¨é¢æŒ‡å¯¼"
          signals:
            - "ä¸çŸ¥é“æ€ä¹ˆåš"
            - "å®Œå…¨ä¸ç†è§£"
            - "èƒ½æ•™æˆ‘å—"
            - "ä»é›¶å¼€å§‹"
          examples:
            - "æˆ‘æƒ³åšå› æœæ¨æ–­ï¼Œä½†ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹ï¼Œä¹Ÿä¸ç†è§£æœ‰å“ªäº›æ–¹æ³•å¯ä»¥ç”¨ã€‚"

      scoring_logic: |
        def score_user_uncertainty(user_message):
            score = 0.0

            # æ£€æµ‹ä¸ç¡®å®šæ€§ä¿¡å·
            high_uncertainty_signals = [
                "ä¸çŸ¥é“", "å®Œå…¨ä¸ç†è§£", "ä»é›¶å¼€å§‹", "confused",
                "no idea", "totally lost"
            ]

            medium_uncertainty_signals = [
                "ä¸ç¡®å®š", "åº”è¯¥ç”¨å“ªä¸ª", "æ˜¯å¦å¯ä»¥", "å“ªä¸ªæ›´å¥½",
                "not sure", "which is better", "should I use"
            ]

            # æ£€æµ‹å…·ä½“æ€§ï¼ˆä½ä¸ç¡®å®šæ€§çš„ä¿¡å·ï¼‰
            has_specific_parameters = check_for_numbers_or_specifics(user_message)
            # ä¾‹å¦‚: "power=0.8", "N=200", "AUC=0.75"

            # è¯„åˆ†
            if any(sig in user_message.lower() for sig in high_uncertainty_signals):
                score = 0.85
            elif any(sig in user_message.lower() for sig in medium_uncertainty_signals):
                score = 0.55
            elif has_specific_parameters:
                score = 0.2
            else:
                # é»˜è®¤ä¸­ç­‰ä¸ç¡®å®šæ€§
                score = 0.5

            return score

    # ç»´åº¦3: ä¸Šä¸‹æ–‡ä¾èµ–æ€§ (Context Dependency)
    context_dependency:
      weight: 0.25

      signal_mapping:
        low_dependency:  # 0.0-0.3
          description: "å­¤ç«‹é—®é¢˜ï¼Œæ— éœ€å†å²ä¸Šä¸‹æ–‡"
          characteristics:
            - "é—®é¢˜è‡ªåŒ…å«"
            - "æ— éœ€å›é¡¾ä¹‹å‰è®¨è®º"
            - "é¦–æ¬¡æé—®"
          examples:
            - "ä»€ä¹ˆæ˜¯på€¼ï¼Ÿ"
            - "å¦‚ä½•è®¡ç®—æ ·æœ¬é‡ï¼Ÿ"

        medium_dependency:  # 0.4-0.7
          description: "éœ€è¦éƒ¨åˆ†å†å²ä¸Šä¸‹æ–‡"
          characteristics:
            - "æ¶‰åŠä¹‹å‰è®¨è®ºçš„å»¶ä¼¸"
            - "éœ€è¦ç†è§£ç ”ç©¶å…¨è²Œ"
            - "å¤šè½®å¯¹è¯çš„ä¸€éƒ¨åˆ†"
          signals:
            - "åˆšæ‰æ‚¨è¯´"
            - "åŸºäºä¹‹å‰çš„"
            - "æˆ‘çš„ç ”ç©¶"
            - "è¿™ä¸ªé¡¹ç›®"
          examples:
            - "åŸºäºä¹‹å‰æ‚¨å»ºè®®çš„RCTè®¾è®¡ï¼Œæˆ‘ç°åœ¨æƒ³ç¡®å®šæ ·æœ¬é‡ã€‚"

        high_dependency:  # 0.8-1.0
          description: "é«˜åº¦ä¾èµ–ç ”ç©¶å…¨è²Œå’Œå†å²"
          characteristics:
            - "éœ€è¦æ•´ä¸ªç ”ç©¶èƒŒæ™¯"
            - "æ¶‰åŠå¤šä¸ªå…ˆå‰å†³ç­–"
            - "æˆ˜ç•¥æ€§é—®é¢˜"
          signals:
            - "ç»¼åˆè€ƒè™‘"
            - "æ•´ä½“æ–¹æ¡ˆ"
            - "ä»é€‰é¢˜åˆ°å‘è¡¨"
          examples:
            - "ç»¼åˆæˆ‘ä¹‹å‰çš„ç ”ç©¶è®¾è®¡ã€ç»Ÿè®¡æ–¹æ³•å’Œç›®æ ‡æœŸåˆŠï¼Œæˆ‘åº”è¯¥å¦‚ä½•è§„åˆ’æ¥ä¸‹æ¥çš„åˆ†æï¼Ÿ"

      scoring_logic: |
        def score_context_dependency(user_message, enriched_context):
            score = 0.0

            # æ£€æµ‹ä¸Šä¸‹æ–‡å¼•ç”¨ä¿¡å·
            context_reference_signals = [
                "åˆšæ‰", "ä¹‹å‰", "earlier", "previous", "æˆ‘çš„ç ”ç©¶", "è¿™ä¸ªé¡¹ç›®",
                "my study", "this project"
            ]

            strategic_signals = [
                "ç»¼åˆ", "æ•´ä½“", "overall", "strategic", "ä»é€‰é¢˜åˆ°",
                "å…¨é¢è§„åˆ’"
            ]

            has_context_ref = any(sig in user_message.lower() for sig in context_reference_signals)
            has_strategic = any(sig in user_message.lower() for sig in strategic_signals)

            # æ£€æŸ¥æ˜¯å¦æœ‰å†å²å¯¹è¯
            has_history = enriched_context.get('recent_history') and len(enriched_context['recent_history']) > 0

            # è¯„åˆ†
            if has_strategic:
                score = 0.9
            elif has_context_ref and has_history:
                score = 0.6
            elif has_history and len(enriched_context['recent_history']) >= 3:
                # å¤šè½®å¯¹è¯ï¼Œå³ä½¿æ²¡æ˜¾å¼å¼•ç”¨ä¹Ÿæœ‰ä¾èµ–æ€§
                score = 0.5
            else:
                score = 0.2

            return score

  # æ€»å¤æ‚åº¦è®¡ç®—å…¬å¼
  formula: |
    def calculate_task_complexity(user_message, enriched_context):
        """
        è®¡ç®—ä»»åŠ¡æ€»å¤æ‚åº¦
        Returns: 0.0-1.0
        """

        # è®¡ç®—å„ç»´åº¦åˆ†æ•°
        conceptual_score = score_conceptual_depth(user_message)
        uncertainty_score = score_user_uncertainty(user_message)
        context_score = score_context_dependency(user_message, enriched_context)

        # åŠ æƒæ±‚å’Œ
        total_complexity = (
            conceptual_score * 0.40 +
            uncertainty_score * 0.35 +
            context_score * 0.25
        )

        return total_complexity

  # å¤æ‚åº¦åˆ†çº§
  complexity_levels:
    trivial:
      range: [0.0, 0.2]
      description: "æç®€å•é—®é¢˜ï¼Œå®šä¹‰çº§åˆ«"

    simple:
      range: [0.2, 0.4]
      description: "ç®€å•é—®é¢˜ï¼Œæ•™ç§‘ä¹¦çº§åˆ«"

    moderate:
      range: [0.4, 0.6]
      description: "ä¸­ç­‰é—®é¢˜ï¼Œéœ€è¦æ–¹æ³•è®ºçŸ¥è¯†"

    complex:
      range: [0.6, 0.8]
      description: "å¤æ‚é—®é¢˜ï¼Œéœ€è¦æ·±å…¥ç†è§£"

    very_complex:
      range: [0.8, 1.0]
      description: "éå¸¸å¤æ‚ï¼Œéœ€è¦æˆ˜ç•¥æ€§æ€ç»´"

# ============================================================================
# Mode Routing Matrix - æ¨¡å¼è·¯ç”±çŸ©é˜µ
# ============================================================================

mode_routing_matrix:

  description: |
    æ ¹æ® (complexity_score, user_level) äºŒç»´çŸ©é˜µ
    è·¯ç”±åˆ°æœ€åˆé€‚çš„å“åº”æ¨¡å¼

  routing_table:
    # [complexity, user_level] â†’ mode + style

    # Row 1: Trivial/Simple complexity (0.0-0.4)
    - condition:
        complexity: [0.0, 0.4]
        user_level: "any"
      route_to: "quick_guidance"
      style:
        response_length: "1-2å¥è¯"
        depth: "direct_answer"
        examples: 0
        resources: 0
      rationale: "ç®€å•é—®é¢˜æ— éœ€å¤æ‚è§£é‡Šï¼Œå¿«é€Ÿå‡†ç¡®å³å¯"

    # Row 2: Moderate complexity + Intermediate/Advanced user
    - condition:
        complexity: [0.4, 0.6]
        user_level: ["intermediate", "advanced"]
      route_to: "mentor_lite"
      style:
        response_length: "ç®€åŒ–è§£é‡Š + 1ä¸ªä¾‹å­"
        depth: "conceptual_explanation"
        examples: 1
        resources: 1
      rationale: "æœ‰ç»éªŒç”¨æˆ·é‡åˆ°ä¸­ç­‰é—®é¢˜ï¼Œæä¾›æ¦‚å¿µæ¡†æ¶å’Œå…³é”®èµ„æº"

    # Row 3: Moderate complexity + Novice user
    - condition:
        complexity: [0.4, 0.6]
        user_level: "novice"
      route_to: "standard_mentor"
      style:
        response_length: "ç»“æ„åŒ–æŒ‡å¯¼ + 2-3ä¸ªä¾‹å­"
        depth: "step_by_step"
        examples: 2-3
        resources: 2-3
      rationale: "æ–°æ‰‹éœ€è¦æ›´è¯¦ç»†çš„æ­¥éª¤æŒ‡å¯¼"

    # Row 4: Complex problem + Advanced user
    - condition:
        complexity: [0.6, 0.8]
        user_level: "advanced"
      route_to: "strategic_advisor"
      style:
        response_length: "æˆ˜ç•¥è®¨è®º + tradeoffsåˆ†æ"
        depth: "high_level_thinking"
        examples: "å®é™…ç ”ç©¶æ¡ˆä¾‹"
        resources: "å‰æ²¿æ–‡çŒ®"
      rationale: "é«˜æ‰‹é‡å¤æ‚é—®é¢˜ï¼Œéœ€è¦æˆ˜ç•¥è§†è§’è€Œéæ‰‹æŠŠæ‰‹æ•™å­¦"

    # Row 5: Complex problem + Intermediate user
    - condition:
        complexity: [0.6, 0.8]
        user_level: "intermediate"
      route_to: "standard_mentor"
      style:
        response_length: "å®Œæ•´æ¡†æ¶ + å¤šè§’åº¦åˆ†æ"
        depth: "comprehensive"
        examples: 3-4
        resources: 3-4
      rationale: "ä¸­çº§ç”¨æˆ·å¤„ç†å¤æ‚é—®é¢˜ï¼Œéœ€è¦å…¨é¢æ”¯æŒ"

    # Row 6: Complex problem + Novice user
    - condition:
        complexity: [0.6, 0.8]
        user_level: "novice"
      route_to: "deep_mentorship"
      style:
        response_length: "äº¤äº’å¼å¼•å¯¼ï¼Œå¯èƒ½éœ€è¦å¤šè½®"
        depth: "concept_building"
        examples: "ä»åŸºç¡€åˆ°é«˜çº§çš„æ¸è¿›å¼ä¾‹å­"
        resources: "å…¥é—¨+è¿›é˜¶èµ„æº"
        interaction: "multi_turn"
      rationale: "æ–°æ‰‹é‡å¤æ‚é—®é¢˜ï¼Œå¯èƒ½è¶…å‡ºå½“å‰èƒ½åŠ›ï¼Œéœ€è¦é™ç»´åˆ†è§£+èƒ½åŠ›åŸ¹å…»"

    # Row 7: Very complex (0.8-1.0) + any user
    - condition:
        complexity: [0.8, 1.0]
        user_level: "any"
      route_to: "deep_mentorship"
      style:
        response_length: "æ·±åº¦å¼•å¯¼"
        depth: "fundamental_principles"
        context_tracking: true
        multi_turn: true
      rationale: "æå¤æ‚é—®é¢˜å¯¹ä»»ä½•äººéƒ½éœ€è¦æ·±åº¦å¼•å¯¼"

  # è·¯ç”±å†³ç­–å‡½æ•°
  routing_logic: |
    def select_mode_from_complexity(complexity_score, user_level):
        """
        æ ¹æ®å¤æ‚åº¦å’Œç”¨æˆ·æ°´å¹³é€‰æ‹©æ¨¡å¼
        Returns: mode name + style config
        """

        # éå†routing_tableï¼Œæ‰¾åˆ°åŒ¹é…çš„æ¡ä»¶
        for route in routing_table:
            complexity_match = (
                route.condition.complexity[0] <= complexity_score < route.condition.complexity[1]
            )

            user_level_match = (
                route.condition.user_level == "any" or
                user_level in route.condition.user_level or
                route.condition.user_level == user_level
            )

            if complexity_match and user_level_match:
                log(f"[Routing] Matched route: {route.route_to}")
                log(f"  â€¢ Complexity: {complexity_score:.2f}")
                log(f"  â€¢ User level: {user_level}")
                log(f"  â€¢ Style: {route.style}")

                return {
                    "mode": route.route_to,
                    "style": route.style,
                    "rationale": route.rationale
                }

        # é»˜è®¤é™çº§
        log("[Routing] No match found, using default: standard_mentor")
        return {
            "mode": "standard_mentor",
            "style": default_style,
            "rationale": "Default fallback"
        }

# ============================================================================
# Response Style Specifications - å“åº”é£æ ¼è§„èŒƒ
# ============================================================================

response_styles:

  quick_guidance:
    description: "å¿«é€ŸæŒ‡æ­£æ¨¡å¼ï¼Œ1-2å¥è¯"
    template: |
      {direct_answer}

      {optional_one_sentence_explanation}

    max_length: 200
    tone: "ç®€æ´ã€å‡†ç¡®"
    examples_count: 0
    resource_links: 0

  mentor_lite:
    description: "è½»é‡çº§å¯¼å¸ˆæ¨¡å¼ï¼Œæ¦‚å¿µ+1ä¾‹å­"
    template: |
      {concept_explanation}

      **ç¤ºä¾‹**:
      {one_example}

      {optional_resource_link}

    max_length: 500
    tone: "æ¸…æ™°ã€å‹å¥½"
    examples_count: 1
    resource_links: 1

  standard_mentor:
    description: "æ ‡å‡†å¯¼å¸ˆæ¨¡å¼ï¼Œå®Œæ•´ç»“æ„åŒ–æŒ‡å¯¼"
    template: |
      {conceptual_framework}

      **æ–¹æ³•/ç­–ç•¥**:
      {multiple_approaches}

      **ç¤ºä¾‹**:
      {2_3_examples}

      **å»¶ä¼¸é˜…è¯»**:
      {2_3_resources}

    max_length: 1500
    tone: "ç³»ç»Ÿã€å…¨é¢"
    examples_count: 2-3
    resource_links: 2-3

  deep_mentorship:
    description: "æ·±åº¦å¯¼å¸ˆæ¨¡å¼ï¼Œæ¦‚å¿µæ„å»º+äº¤äº’å¼"
    template: |
      {fundamental_principles}

      {layered_explanation}  # ä»åŸºç¡€åˆ°é«˜çº§

      **ç»ƒä¹ /æ€è€ƒ**:
      {interactive_questions}

      **èµ„æºè·¯å¾„**:
      {learning_roadmap}

      {follow_up_prompt}  # æç¤ºç”¨æˆ·å¯ä»¥ç»§ç»­æé—®

    max_length: 2500
    tone: "è€å¿ƒã€å¼•å¯¼å¼"
    examples_count: "æ¸è¿›å¼å¤šä¸ª"
    resource_links: "åˆ†å±‚æ¬¡"
    interaction_style: "multi_turn_expected"

  strategic_advisor:
    description: "æˆ˜ç•¥é¡¾é—®æ¨¡å¼ï¼Œé«˜å±‚æ¬¡æ€ç»´"
    template: |
      {big_picture_context}

      **Tradeoffsåˆ†æ**:
      {option_1_pros_cons}
      {option_2_pros_cons}

      **å½±å“åŠ›è€ƒé‡**:
      {impact_prediction}

      **å»ºè®®**:
      {strategic_recommendation}

    max_length: 1200
    tone: "å®¢è§‚ã€åˆ†æå¼"
    examples_count: "å®é™…ç ”ç©¶æ¡ˆä¾‹"
    resource_links: "å‰æ²¿æ–‡çŒ®"
    focus: "decision_support"

# ============================================================================
# Integration with V2.1 Decision Logic - ä¸V2.1å†³ç­–é€»è¾‘é›†æˆ
# ============================================================================

integration_workflow:

  in_pre_guidance_phase:
    description: "åœ¨Pre-Guidanceé˜¶æ®µè®¡ç®—å¤æ‚åº¦"
    implementation: |
      # åœ¨ pre_guidance_phase() ä¸­æ·»åŠ  Step 6

      enriched_context['complexity_score'] = calculate_task_complexity(
          user_message=user_message,
          enriched_context=enriched_context
      )

      enriched_context['complexity_level'] = get_complexity_level(
          enriched_context['complexity_score']
      )

  in_decision_phase:
    description: "åœ¨Decisioné˜¶æ®µé€‰æ‹©æ¨¡å¼"
    implementation: |
      # åœ¨ calculate_urgency_v2_enhanced() ä¸­

      # åŸºäºå¤æ‚åº¦é€‰æ‹©æ¨¡å¼ï¼ˆæ›¿ä»£æˆ–è¡¥å……åŸæœ‰çš„mode selectionï¼‰
      routing_result = select_mode_from_complexity(
          complexity_score=enriched_context['complexity_score'],
          user_level=enriched_context['user_profile'].overall_level
      )

      recommended_mode = routing_result['mode']
      response_style = routing_result['style']

  in_generation_phase:
    description: "åœ¨Generationé˜¶æ®µåº”ç”¨style"
    implementation: |
      # åœ¨ generate_guidance_response() ä¸­

      guidance_response = generate_with_style(
          user_message=user_message,
          decision_result=decision_result,
          style_config=routing_result['style'],
          template_cases=enriched_context['similar_success_cases']
      )

# ============================================================================
# ç¤ºä¾‹åœºæ™¯
# ============================================================================

example_scenarios:

  scenario_1_simple_question:
    user_message: "ä»€ä¹ˆæ˜¯på€¼ï¼Ÿ"
    user_level: "novice"

    complexity_breakdown:
      conceptual_depth: 0.1  # ä½å¤æ‚åº¦å…³é”®è¯
      user_uncertainty: 0.2  # é—®é¢˜æ˜ç¡®
      context_dependency: 0.2  # å­¤ç«‹é—®é¢˜
      total: 0.15

    routing_result:
      mode: "quick_guidance"
      style: "1-2å¥è¯ç›´æ¥å›ç­”"

    sample_response: |
      på€¼æ˜¯åœ¨é›¶å‡è®¾ä¸ºçœŸçš„æƒ…å†µä¸‹ï¼Œè§‚å¯Ÿåˆ°å½“å‰æ•°æ®ï¼ˆæˆ–æ›´æç«¯ï¼‰çš„æ¦‚ç‡ã€‚
      é€šå¸¸p<0.05è¢«è§†ä¸ºç»Ÿè®¡æ˜¾è‘—ï¼Œä½†ä¸ä»£è¡¨ä¸´åºŠé‡è¦æ€§ã€‚

  scenario_2_moderate_question_intermediate:
    user_message: "æˆ‘çš„è§‚å¯Ÿæ€§ç ”ç©¶æƒ³æ§åˆ¶æ··æ‚ï¼Œåº”è¯¥ç”¨å€¾å‘æ€§è¯„åˆ†è¿˜æ˜¯å¤šå…ƒå›å½’ï¼Ÿ"
    user_level: "intermediate"

    complexity_breakdown:
      conceptual_depth: 0.5  # ä¸­ç­‰å…³é”®è¯ï¼ˆå€¾å‘æ€§è¯„åˆ†ï¼‰
      user_uncertainty: 0.55  # æœ‰ç–‘é—®ä½†æ–¹å‘æ¸…æ¥š
      context_dependency: 0.4  # éƒ¨åˆ†ä¾èµ–ç ”ç©¶èƒŒæ™¯
      total: 0.49

    routing_result:
      mode: "mentor_lite"
      style: "æ¦‚å¿µè§£é‡Š + 1ä¸ªä¾‹å­ + 1ä¸ªèµ„æº"

    sample_response: |
      ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜åŠ¿ï¼š

      **å¤šå…ƒå›å½’**: é€‚åˆæ··æ‚å› ç´ æ•°é‡é€‚ä¸­ï¼ˆ<10ï¼‰ï¼Œä¸”å…³ç³»ç›¸å¯¹çº¿æ€§ã€‚
      **å€¾å‘æ€§è¯„åˆ†**: é€‚åˆæ··æ‚å› ç´ å¤šï¼Œæˆ–éœ€è¦æ¨¡ä»¿RCTçš„å¹³è¡¡æ€§ã€‚

      **ç¤ºä¾‹**: å¦‚æœæ‚¨æœ‰15ä¸ªæ··æ‚å› ç´ ä¸”æ ·æœ¬é‡N=300ï¼Œå€¾å‘æ€§è¯„åˆ†å¯èƒ½æ›´ç¨³å¥ï¼ˆé¿å…è¿‡æ‹Ÿåˆï¼‰ã€‚

      **å»¶ä¼¸**: Austin (2011). An Introduction to Propensity Score Methods. (ç»å…¸ç»¼è¿°)

  scenario_3_complex_novice:
    user_message: "æˆ‘æƒ³è¯æ˜ç¤¾äº¤åª’ä½“ä½¿ç”¨å¯¼è‡´æŠ‘éƒï¼Œä½†åªæœ‰æ¨ªæ–­é¢æ•°æ®ï¼Œä¸çŸ¥é“æ€ä¹ˆåšå› æœæ¨æ–­ã€‚"
    user_level: "novice"

    complexity_breakdown:
      conceptual_depth: 0.8  # å› æœæ¨æ–­é«˜å¤æ‚åº¦
      user_uncertainty: 0.9  # å®Œå…¨ä¸çŸ¥é“æ€ä¹ˆåš
      context_dependency: 0.6  # éœ€è¦ç ”ç©¶å…¨è²Œ
      total: 0.78

    routing_result:
      mode: "deep_mentorship"
      style: "æ¦‚å¿µæ„å»º + å¤šå±‚æ¬¡è§£é‡Š + äº¤äº’å¼"

    sample_response: |
      ğŸ“ è®©æˆ‘ä»¬ä»å› æœæ¨æ–­çš„åŸºç¡€å¼€å§‹ï¼š

      **æ ¸å¿ƒé—®é¢˜**: å› æœ vs. å…³è”

      æ¨ªæ–­é¢æ•°æ®çš„æŒ‘æˆ˜ï¼š
      1. æ— æ³•å»ºç«‹æ—¶åºæ€§ï¼ˆXâ†’Yè¿˜æ˜¯Yâ†’Xï¼Ÿï¼‰
      2. æ— æ³•æ’é™¤æ··æ‚
      3. æ— æ³•æ’é™¤åå‘å› æœ

      **å¯è¡Œè·¯å¾„**ï¼ˆä»ç®€åˆ°éš¾ï¼‰ï¼š

      **è·¯å¾„1**: è°ƒæ•´è¯­è¨€ï¼ˆæœ€ç®€å•ï¼‰
      - ä¸è¯´"å¯¼è‡´"ï¼Œæ”¹ä¸º"å…³è”"
      - Logistic regressionå¯ä»¥ç”¨ï¼Œä½†ç»“è®ºè°¨æ…

      **è·¯å¾„2**: æ–¹æ³•æ”¹è¿›
      - å¦‚æœå¯èƒ½ï¼Œæ”¹ä¸ºçºµå‘è®¾è®¡ï¼ˆ6ä¸ªæœˆfollow-upï¼‰
      - ä½¿ç”¨å·¥å…·å˜é‡ï¼ˆå¦‚åœ°åŒºsocial mediaæ™®åŠç‡ï¼‰
      - æ•æ„Ÿæ€§åˆ†æ

      **è·¯å¾„3**: ç†è®ºæ¡†æ¶
      - æ„å»ºå› æœå›¾ï¼ˆDAGï¼‰è¯†åˆ«æ··æ‚è·¯å¾„
      - å³ä½¿æ¨ªæ–­é¢ï¼Œä¹Ÿèƒ½æ˜ç¡®å‡è®¾

      **ç»ƒä¹ **: æ‚¨è®¤ä¸º"æŠ‘éƒâ†’å¤šç”¨ç¤¾äº¤åª’ä½“"ï¼ˆåå‘å› æœï¼‰çš„å¯èƒ½æ€§æœ‰å¤šå¤§ï¼Ÿ

      **å­¦ä¹ è·¯å¾„**:
      1. å…ˆç†è§£DAG: Pearlçš„å› æœå›¾å…¥é—¨
      2. å†å­¦ä¹ å·¥å…·å˜é‡: Angristçš„è‡ªç„¶å®éªŒæ–¹æ³•
      3. æœ€åçœ‹å®ä¾‹: Twenge (2018)çš„ç¤¾äº¤åª’ä½“ç ”ç©¶

      æœ‰ç–‘é—®éšæ—¶é—®ï¼æˆ‘ä»¬å¯ä»¥ä¸€æ­¥æ­¥æ¥ã€‚

  scenario_4_very_complex_advanced:
    user_message: "ç»¼åˆæˆ‘çš„ç ”ç©¶ï¼ˆç¤¾äº¤åª’ä½“ä¸æŠ‘éƒçš„RCTä¸å¯è¡Œï¼‰ï¼Œç›®æ ‡æœŸåˆŠæ˜¯NEJM levelï¼Œæˆ‘åº”è¯¥å¦‚ä½•è®¾è®¡ä¸€ä¸ªconvincingçš„å› æœæ¨æ–­ç­–ç•¥ï¼ŸåŒ…æ‹¬è¯†åˆ«ç­–ç•¥ã€ç¨³å¥æ€§æ£€éªŒã€ä»¥åŠå¦‚ä½•åº”å¯¹å®¡ç¨¿äººè´¨ç–‘ã€‚"
    user_level: "advanced"

    complexity_breakdown:
      conceptual_depth: 0.9  # é«˜çº§å› æœæ¨æ–­
      user_uncertainty: 0.6  # æœ‰æ–¹å‘ä½†éœ€è¦æˆ˜ç•¥
      context_dependency: 0.95  # é«˜åº¦ä¾èµ–ç ”ç©¶å…¨è²Œ
      total: 0.82

    routing_result:
      mode: "deep_mentorship"  # å³ä½¿advancedä¹Ÿéœ€è¦deepï¼ˆå› ä¸ºcomplexityå¾ˆé«˜ï¼‰
      style: "æˆ˜ç•¥æ€§+å¤šç»´åº¦åˆ†æ"

    sample_response: |
      ğŸ“Š **æˆ˜ç•¥çº§å› æœæ¨æ–­è®¾è®¡**

      å¯¹äºNEJM-levelæœŸåˆŠï¼Œæ‚¨éœ€è¦çš„æ˜¯**å‡†å®éªŒè®¾è®¡ + å¤šé‡ç¨³å¥æ€§**ç­–ç•¥ã€‚

      **è¯†åˆ«ç­–ç•¥æ ¸å¿ƒ**:

      æ–¹æ¡ˆA: **Target Trial Emulation** (æœ€å¼º)
      - æ¨¡æ‹Ÿç†æƒ³RCTçš„è®¾è®¡
      - æ˜ç¡®eligibility, treatment assignment, follow-up
      - HernÃ¡nçš„æ¡†æ¶ (2016, Ann Intern Med)

      æ–¹æ¡ˆB: **å·¥å…·å˜é‡ + DID**
      - IV: åˆ©ç”¨æ”¿ç­–å˜åŒ–ï¼ˆå¦‚æŸåœ°åŒºsocial media banï¼‰
      - DID: Before-after + treatment-control
      - éœ€è¦å¹³è¡Œè¶‹åŠ¿å‡è®¾

      **å¤šé‡ç¨³å¥æ€§æ£€éªŒ** (åº”å¯¹å®¡ç¨¿äºº):
      1. E-valueåˆ†æ: æœªæµ‹æ··æ‚éœ€è¦å¤šå¼ºæ‰èƒ½æ¨ç¿»ç»“æœï¼Ÿ
      2. è´Ÿå¯¹ç…§: é€‰ä¸€ä¸ªç†è®ºä¸Šä¸è¯¥æœ‰å› æœçš„outcomeæµ‹è¯•
      3. Placebo test: åœ¨å¹²é¢„å‰æœŸä¸åº”è¯¥æœ‰æ•ˆåº”
      4. æ•æ„Ÿæ€§åˆ†æçŸ©é˜µ: ä¸åŒå‡è®¾ä¸‹çš„ç»“æœç¨³å¥æ€§

      **NEJMå®¡ç¨¿é‡ç‚¹**:
      - ä¸´åºŠæ„ä¹‰ > ç»Ÿè®¡æ˜¾è‘—æ€§
      - å¯é‡å¤æ€§å’Œé€æ˜åº¦
      - å¯¹æ”¿ç­–/ä¸´åºŠå®è·µçš„å½±å“

      **Differentiationç­–ç•¥**:
      - ä¸åšgeneralçš„"social media â†’ depression"
      - Focus on mechanism: å¦‚sleep mediation, FOMO pathway
      - æˆ–ç‰¹å®švulnerableç¾¤ä½“

      **é¢„æœŸå®¡ç¨¿äººè´¨ç–‘**:
      Q: "ä¸ºä»€ä¹ˆä¸åšRCTï¼Ÿ"
      A: Ethical + feasibility â†’ å‡†å®éªŒæ˜¯æ¬¡ä¼˜é€‰æ‹©

      Q: "å¦‚ä½•æ’é™¤åå‘å› æœï¼Ÿ"
      A: Target trial + æ—¶åºæ€§è¯æ® + sensitivity analysis

      æ‚¨æƒ³æ·±å…¥è®¨è®ºå“ªä¸ªéƒ¨åˆ†ï¼Ÿæˆ‘ä»¬å¯ä»¥æ„å»ºå®Œæ•´çš„analysis planã€‚

# ============================================================================
# æ€§èƒ½ç›‘æ§
# ============================================================================

performance_metrics:

  routing_accuracy:
    metric: "è·¯ç”±å†³ç­–ä¸ç”¨æˆ·æ»¡æ„åº¦çš„åŒ¹é…"
    target: "> 85%"
    measurement: "ç”¨æˆ·åé¦ˆæˆ–éšå¼ä¿¡å·"

  complexity_prediction_accuracy:
    metric: "å¤æ‚åº¦è¯„åˆ†ä¸å®é™…éš¾åº¦çš„ç›¸å…³æ€§"
    target: "Correlation > 0.75"
    measurement: "response_length, interaction_turnsä½œä¸ºproxy"

  mode_distribution:
    healthy_range:
      quick_guidance: "20-30%"
      mentor_lite: "15-25%"
      standard_mentor: "30-40%"
      deep_mentorship: "10-20%"
      strategic_advisor: "5-10%"

    alerts:
      if_quick_guidance_gt_40: "å¯èƒ½è¿‡åº¦ç®€åŒ–å¤æ‚é—®é¢˜"
      if_deep_mentorship_gt_30: "å¯èƒ½è¿‡åº¦å¤æ‚åŒ–ç®€å•é—®é¢˜"

# ============================================================================
# æœªæ¥å¢å¼º (V2.5+)
# ============================================================================

future_enhancements:

  adaptive_complexity_threshold:
    description: "æ ¹æ®ç”¨æˆ·å†å²åŠ¨æ€è°ƒæ•´å¤æ‚åº¦é˜ˆå€¼"
    example: "å¦‚æœç”¨æˆ·è¿ç»­æ­£ç¡®å¤„ç†0.7å¤æ‚åº¦é—®é¢˜ï¼Œå°†medium_complexityä¸Šé™ä»0.7æå‡åˆ°0.75"

  neural_routing:
    description: "ä»å†å² (complexity, user_level, mode, satisfaction) å­¦ä¹ æœ€ä¼˜è·¯ç”±"
    method: "Pattern learningç±»ä¼¼Claude-Flow"

  multi_agent_routing:
    description: "å¯¹äºvery_complexé—®é¢˜ï¼Œè·¯ç”±åˆ°å¤šä¸ªspecialist agentsåä½œ"
    condition: "complexity > 0.9 ä¸” æ¶‰åŠå¤šä¸ªé¢†åŸŸ"
